---
phase: 05-agent-health-monitoring
task: 0
total_tasks: 4
status: planned
last_updated: 2026-02-08T05:07:47.775Z
---

<current_state>
Phase 5 planning is COMPLETE. Research, planning, and verification all passed. Ready to execute.

- 05-RESEARCH.md written (HIGH confidence)
- 05-01-PLAN.md created (Wave 1: core health detection functions)
- 05-02-PLAN.md created (Wave 2: MCP tool exposure)
- Plan verification passed (gsd-plan-checker)

No code has been written yet. Execution is the next step.
</current_state>

<completed_work>

- Research: Completed (tmux pane liveness, hung detection via content hashing, grace period, existing force_kill_teammate reuse)
- Plan 05-01: Defined (AgentHealthStatus model, check_pane_alive, capture_pane_content_hash, check_single_agent_health, health state persistence, 18+ tests)
- Plan 05-02: Defined (check_agent_health + check_all_agents_health MCP tools, 7+ integration tests)
- Verification: Passed (all requirements covered, dependencies valid, scope healthy)
</completed_work>

<remaining_work>

**Wave 1 - Plan 05-01 (2 tasks):**
- Task 1: Add AgentHealthStatus model and core detection functions to models.py and spawner.py
- Task 2: Add 18+ tests covering pane liveness, content hashing, combined health check, state persistence

**Wave 2 - Plan 05-02 (2 tasks):**
- Task 1: Add check_agent_health and check_all_agents_health MCP tools to server.py
- Task 2: Add 7+ integration tests for the MCP tools
</remaining_work>

<decisions_made>

- **Detection-only approach:** Phase 5 adds detection only; `force_kill_teammate` already exists for the action
- **No remain-on-exit:** Missing pane = dead (simple, unambiguous signal)
- **Grace period 60s:** Newly spawned agents protected from false hung detection during startup
- **Hung timeout 120s:** Configurable, content hash unchanged for >120s = hung
- **Health state persistence via health.json:** Stored at `~/.claude/teams/<name>/health.json`, enables hung detection across tool calls
- **No auto-kill:** Health tools return status; team lead decides whether to call force_kill_teammate
</decisions_made>

<blockers>
None. Planning complete and verified.
</blockers>

<context>
Just finished `/gsd:plan-phase 5` which ran the full workflow:
1. Research agent explored tmux pane detection and hung detection patterns
2. Planner created 2 plans in 2 waves with proper dependencies
3. Plan checker verified all requirements covered, scope healthy, dependencies valid

The phase is well-scoped: adds detection capability to enable monitoring of agent health. The existing force_kill_teammate handles termination, so Phase 5 focuses purely on the "detect" side of RELY-03/RELY-04.

Key insight from research: tmux's `pane_dead` format variable and `capture-pane` command provide everything needed. No new dependencies, all stdlib.
</context>

<next_action>
Run `/gsd:execute-phase 5` to execute both plans.

Recommend `/clear` first for fresh context window.
</next_action>
